
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Cattails vs Fire</title>
<style>
  body {
    background: #d6f5d6;
    text-align: center;
    font-family: "Comic Sans MS", sans-serif;
  }
  canvas {
    background: #aef7ae;
    border: 4px solid #333;
    margin-top: 10px;
  }
  #info {
    margin-top: 10px;
  }
</style>
</head>
<body>
<h1>üî• Cattails vs Fire üåø</h1>
<p id="info">
  Click a tile to plant a cattail. Water regenerates over time.<br />
  1Ô∏è‚É£ Basic (50) | 2Ô∏è‚É£ Rapid (100) | 3Ô∏è‚É£ Freeze (150) | 4Ô∏è‚É£ Boom (150) | 5Ô∏è‚É£ Crack (300) | 6Ô∏è‚É£ Drenched (250) | 9Ô∏è‚É£ Well (100)
</p>
<canvas id="game" width="800" height="400"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const rows = 5, cols = 9;
const cellW = canvas.width / cols, cellH = canvas.height / rows;

let cattails = [];
let fires = [];
let projectiles = [];
let water = 100;
let wave = 0;
let cattailType = 1;
let gameOver = false;
let nextWaveReady = true;

// --- Load Images ---
const wellImg = new Image();
wellImg.src = "well.png";
const basicImg = new Image();
basicImg.src = "basic.png"; // <- Replace with your image
const rapidImg = new Image();
rapidImg.src = "rapid.png"; // <- Replace with your image
const freezeImg = new Image();
freezeImg.src = "freeze.png"; // <- Replace with your image
const boomImg = new Image();
boomImg.src = "boom.png";
const explodeImg = new Image();
explodeImg.src = "explode.png";
const crackImg = new Image();
crackImg.src = "crack.png";
const drenchedImg = new Image();
drenchedImg.src = "drenched.png";
const splashImg = new Image();
splashImg.src = "splash.png";
const fireImg = new Image();
fireImg.src = "fire.png"; // <- Replace with your image
const strongImg = new Image();
strongImg.src = "strong.png";
const bossImg = new Image();
bossImg.src = "boss.png";
const megaImg = new Image();
megaImg.src = "mega.png";

// ---------- Cattails ----------
class Cattail {
  constructor(r, c) {
    this.row = r;
    this.col = c;
    this.x = c * cellW + cellW / 2;
    this.y = r * cellH + cellH / 2;
    this.shootTimer = 0;
    this.die = false;
  }
  update() {}
  draw() {}
}
class WellCattail extends Cattail {
  constructor(r, c) {
    super(r, c);
    this.shootRate = 60;
    this.image = wellImg;
  }
  update() {
    this.shootTimer++;
    if (this.shootTimer > this.shootRate) {
      water += 5;
      this.shootTimer = 0;
    }
  }
  draw() {
    ctx.drawImage(this.image, this.x - 25, this.y - 25, 50, 50);
  }
}
class BasicCattail extends Cattail {
  constructor(r, c) {
    super(r, c);
    this.shootRate = 60;
    this.image = basicImg;
  }
  update() {
    this.shootTimer++;
    if (this.shootTimer > this.shootRate) {
      projectiles.push(new Projectile(this.x + 20, this.y, "blue"));
      this.shootTimer = 0;
    }
  }
  draw() {
    ctx.drawImage(this.image, this.x - 25, this.y - 25, 50, 50);
  }
}

class RapidCattail extends Cattail {
  constructor(r, c) {
    super(r, c);
    this.shootRate = 30;
    this.image = rapidImg;
  }
  update() {
    this.shootTimer++;
    if (this.shootTimer > this.shootRate) {
      projectiles.push(new Projectile(this.x + 20, this.y, "deepskyblue"));
      this.shootTimer = 0;
    }
  }
  draw() {
    ctx.drawImage(this.image, this.x - 25, this.y - 25, 50, 50);
  }
}

class FreezeCattail extends Cattail {
  constructor(r, c) {
    super(r, c);
    this.shootRate = 90;
    this.image = freezeImg;
  }
  update() {
    this.shootTimer++;
    if (this.shootTimer > this.shootRate) {
      projectiles.push(new Projectile(this.x + 20, this.y, "cyan", true));
      this.shootTimer = 0;
    }
  }
  draw() {
    ctx.drawImage(this.image, this.x - 25, this.y - 25, 50, 50);
  }
}
class BoomCattail extends Cattail {
  constructor(r, c) {
    super(r, c);
    this.triggerX = this.x + 50;
    this.image = boomImg;
    this.explodetime = -1;
  }
  update() {
    if (this.explodetime > 0) {
      this.explodetime--;
    }
    for (let index = 0; index < fires.length; index++) {
      const element = fires[index];
      if (element.x >= this.x && element.x <= this.triggerX && element.row == this.row) {
        this.explodetime = 60;
        element.hp = 0;
        
      }
      
    }
    if (this.explodetime == 0) {
      
      this.die = true;
    }
    
    
  }
  draw() {
    ctx.drawImage(this.image, this.x - 25, this.y - 25, 50, 50);
    if (this.explodetime > 0) {
      ctx.drawImage(explodeImg, this.x - 100, this.y - 100, 200, 200);
    }
  }
}
class CrackCattail extends Cattail {
  constructor(r, c) {
    super(r, c);
    this.triggerX = this.x + 50;
    this.image = crackImg;
    this.lifetime = 500;
    this.stuck = [];
  }
  update() {
    if (this.lifetime > 0) {
      this.lifetime--;
    }
    if (this.lifetime === 0) {
      for (let index = 0; index < this.stuck.length; index++) {
        const element = this.stuck[index];
        element.abled = true;
        
      }
      this.die = true;
    }
    for (const f of fires) {
      if (
        f.abled && // only freeze ones still moving
        f.x >= this.x &&
        f.x <= this.triggerX &&
        f.row === this.row &&
        !this.stuck.includes(f)
      ) {
        f.abled = false;
        this.stuck.push(f);
      }
    }
    
    
  }
  draw() {
    ctx.drawImage(this.image, this.x - 25, this.y - 25, 50, 50);
  }
}
class DrenchedCattail extends Cattail {
  constructor(r, c) {
    super(r, c);
    this.image = freezeImg;
    this.killtime = 60;
  }
  update() {
    if (this.killtime > 0) {
      this.killtime--;
    }
    if (this.killtime === 0) {
      for (const f of fires) {
        f.splash();
        this.die = true;
      }
    }
  }
  draw() {
    ctx.drawImage(drenchedImg, this.x - 25, this.y - 25, 50, 50);
  }
}

// ---------- Fires ----------
class Fire {
  constructor(r, type = "small", difficulty = 1) {
    this.row = r;
    this.type = type;
    this.y = r * cellH + cellH / 2;
    this.slowTimer = 0;
    this.abled = true;
    this.splashtime = -1;

    // base stats
    let baseHp, baseSpeed, color, size, image;
    if (type === "small") {
      baseHp = 3;
      baseSpeed = 0.7;
      color = "red";
      size = 25;
      baseHp *= 1 + 0.1 * (difficulty - 1);
      baseSpeed *= 1 + 0.03 * (difficulty - 1);
      image = fireImg;
    } else if (type === "strong") {
      baseHp = 6;
      baseSpeed = 0.4;
      color = "darkred";
      size = 28;
      baseHp *= 1 + 0.15 * (difficulty - 1);
      baseSpeed *= 1 + 0.02 * (difficulty - 1);
      image = strongImg;
    } else if (type === "boss") {
      baseHp = 25;
      baseSpeed = 0.25;
      color = "purple";
      size = 40;
      baseHp *= 1 + 0.2 * (difficulty - 1);
      baseSpeed *= 1 + 0.05 * (difficulty - 1);
      image = bossImg;
    } else if (type === "mega") {
        baseHp = 100;
        baseSpeed = 0.20;
        color = "black";
        size = 80;
        baseHp *= 1 + 0.5 * (difficulty - 1);
        baseSpeed *= 1 + 0.2 * (difficulty - 1);
        image = megaImg;
    }

    this.x = canvas.width - 30;
    this.hp = Math.round(baseHp);
    this.speed = baseSpeed;
    this.color = color;
    this.size = size;
    this.image = image;
  }
  splash() {
    this.splashtime = 60;
  }
  update() {
    if (this.splashtime > 0) {
      this.splashtime--;
    }
    if (this.splashtime === 0) {
      fires = fires.filter(f => !f.splashtime == 0);
    }
    let currentSpeed = this.speed;
    if (this.slowTimer > 0) {
      this.slowTimer--;
      currentSpeed *= 0.5;
    } 
    if (this.abled) {
      this.x -= currentSpeed;
    }
  }
  draw() {
    // Optional: draw with image
    if (fireImg.complete) {
      if (this.splashtime == -1) {
        ctx.drawImage(this.image, this.x - this.size, this.y - this.size, this.size * 2, this.size * 2);
      }
    } else {
      ctx.fillStyle = this.color;
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
      ctx.fill();
    }
    if (this.splashtime > 0) {
      ctx.drawImage(splashImg, this.x - 100, this.y - 100, 200, 200)
    }
  }
}

// ---------- Projectile ----------
class Projectile {
  constructor(x, y, color, freeze = false) {
    this.x = x;
    this.y = y;
    this.speed = 4;
    this.color = color;
    this.freeze = freeze;
  }
  update() {
    this.x += this.speed;
  }
  draw() {
    ctx.fillStyle = this.color;
    ctx.beginPath();
    ctx.arc(this.x, this.y, 5, 0, Math.PI * 2);
    ctx.fill();
  }
}

// ---------- Waves ----------
function spawnWave() {
  wave++;
  nextWaveReady = false;
  console.log(`Wave ${wave} started`);

  const difficulty = wave;

    if (wave % 5 === 0 &&!(wave % 20 === 0)) {
    fires.push(new Fire(Math.floor(Math.random() * rows), "boss", difficulty / 5));
  } else if(wave % 20 === 0) {
    fires.push(new Fire(2, "mega", difficulty / 20))
  } else {
    for (let i = 0; i < wave + 2; i++) {
      let row = Math.floor(Math.random() * rows);
      let type = Math.random() < 0.3 ? "strong" : "small";
      fires.push(new Fire(row, type, difficulty));
    }
  }
}

// ---------- Input ----------
canvas.addEventListener("click", e => {
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;
  const col = Math.floor(x / cellW);
  const row = Math.floor(y / cellH);

  if (cattails.some(c => c.row === row && c.col === col)) return;

  if (cattailType === 1 && water >= 50) {
    cattails.push(new BasicCattail(row, col));
    water -= 50;
  } else if (cattailType === 2 && water >= 100) {
    cattails.push(new RapidCattail(row, col));
    water -= 100;
  } else if (cattailType === 3 && water >= 150) {
    cattails.push(new FreezeCattail(row, col));
    water -= 150;
  } else if (cattailType === 9 && water >= 100) {
    cattails.push(new WellCattail(row, col));
    water -= 100;
  } else if (cattailType === 4 && water >= 150) {
    cattails.push(new BoomCattail(row, col));
    water -= 150;
  } else if (cattailType === 5 && water >= 300) {
    cattails.push(new CrackCattail(row, col));
    water -= 300;
  } else if (cattailType === 6 && water >= 250) {
    cattails.push(new DrenchedCattail(row, col));
    water -= 250;
  }
});

window.addEventListener("keydown", e => {
  if (["9", "1", "2", "3", "4", "5", "6"].includes(e.key)) cattailType = parseInt(e.key);
  if (e.key == "/") hack();
});
function hack() {
  var command = prompt("Yes Master?");
  if (command == "nextWave") {
    fires = [];
  } else if (command == "setWave") {
    fires = [];
    wave = parseInt(prompt("What wave?"));
  } else if (command == "setWater") {
    water = parseInt(prompt("How much water?"));
  } else if (command == "drenchAll") {
    for (const f of fires) {
      f.splash();
    }
  }
}

// ---------- Game Logic ----------
function update() {
  if (gameOver) return;

  // Regenerate water
  water = Math.min(500, water + 0.1);

  // Start next wave if fires are gone
  if (fires.length === 0 && nextWaveReady) {
    spawnWave();
  }

  cattails.forEach(c => c.update());
  fires.forEach(f => f.update());
  projectiles.forEach(p => p.update());

  // Collision
  projectiles.forEach(p => {
    fires.forEach(f => {
      if (Math.abs(p.x - f.x) < f.size && Math.abs(p.y - f.y) < f.size) {
        f.hp--;
        if (p.freeze) f.slowTimer = 120;
        p.hit = true;
      }
    });
  });

  projectiles = projectiles.filter(p => !p.hit);
  fires = fires.filter(f => f.hp > 0);
  var newcat = [];
  for (let index = 0; index < cattails.length; index++) {
    const element = cattails[index];
    if (element.die) {
      console.log("boohoo");
    } else {
      newcat.push(element);
    }
    
  }
  cattails = newcat;

  // When all fires gone, mark ready for next wave
  if (fires.length === 0 && !nextWaveReady) {
    nextWaveReady = true;
  }

  // Lose condition
  fires.forEach(f => {
    if (f.x < 0 && !gameOver) {
      gameOver = true;
      alert("üî• Game Over! The fire reached your cattails!");
      document.location.reload();
    }
  });
}

// ---------- Drawing ----------
function drawGrid() {
  for (let r = 0; r < rows; r++) {
    for (let c = 0; c < cols; c++) {
      ctx.strokeStyle = "black";
      ctx.strokeRect(c * cellW, r * cellH, cellW, cellH);
    }
  }
}

function drawHUD() {
  ctx.fillStyle = "black";
  ctx.font = "20px Arial";
  ctx.fillText(`Water: ${Math.floor(water)} | Wave: ${wave}`, 10, 25);
  ctx.fillText(`Selected: ${["Basic", "Rapid", "Freeze","Boom","Crack","Drenched","","","Well"][cattailType - 1]}`, 10, 50);
  if (fires.length === 0) {
    ctx.fillText("üåä Next wave soon...", 600, 25);
  }
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawGrid();
  cattails.forEach(c => c.draw());
  fires.forEach(f => f.draw());
  projectiles.forEach(p => p.draw());
  drawHUD();
}

function gameLoop() {
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

nextWaveReady = true;
gameLoop();
</script>
</body>
</html>
